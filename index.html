
<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>کتابخانه دیجیتال محمّدپارسا - فیلترشونده</title>
<style>
/* پایه */
body{font-family: 'IRANSansWeb', Tahoma, Calibri, Arial, sans-serif;background:#fff;padding:20px;color:#1d1d1d}
.header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:18px}
.header h1{margin:0;font-size:1.6rem;color:#1d1d1d}
.controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.controls input[type="search"]{padding:8px 12px;border-radius:8px;border:1px solid #ddd;width:220px}
.btn{background:#fff;border:1px solid #e0e0e0;padding:8px 12px;border-radius:10px;cursor:pointer;transition:all .18s}
.btn.active{background:#D00400;color:#fff;border-color:#b30000}

/* شبکه و کارت */
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:18px}
.card{background:#fff;border-radius:12px;overflow:hidden;border:1px solid #eee;box-shadow:0 6px 18px rgba(0,0,0,0.06);display:flex;flex-direction:column;transition:transform .22s, box-shadow .22s}
.card:hover{transform:translateY(-6px);box-shadow:0 18px 35px rgba(0,0,0,0.09)}
.cover{width:100%;aspect-ratio:2/3;object-fit:cover;background:#f6f6f6}
.info{padding:12px;display:flex;flex-direction:column;gap:8px}
.title{font-weight:600;font-size:1rem;color:#1d1d1d}

/* ساختار شش‌تکه متا */
.meta-rows{display:flex;flex-direction:column;gap:1px;font-size:0.95rem;color:#555}
.meta-row{display:flex;gap:1px;align-items:center;flex-wrap:wrap}
.meta-label{min-width:84px;color:#AAAAA3;font-weight:400}
.meta-value{color:#54529c;font-weight:600;word-break:break-word}

/* فوتر کارت */
.footer{margin-top:auto;display:flex;justify-content:space-between;align-items:center;padding-top:8px;border-top:1px solid #f3f3f3}
.badge{padding:6px 10px;border-radius:999px;font-size:0.85rem}
.badge.read{background:#e0f2f1;color:#00796b}
.badge.unread{background:#fff3e0;color:#ef6c00}
.badge.reading{background:#e8eaf6;color:#3949ab}
.price{font-weight:700;color:#D00400}

/* انیمیشن */
.fade-in{animation:fadeIn .35s ease both}
@keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}

@media (max-width:600px){
  .controls input[type="search"]{width:140px}
}
</style>
</head>
<body>
<div class="header">
  <h1>کتابخانه دیجیتال محمّدپارسا</h1>
  <div class="controls">
    <input type="search" id="search" placeholder="جستجو بر اساس عنوان، نویسنده...">
    <button class="btn" data-filter="all">همه</button>
    <button class="btn" data-filter="خوانده شده">خوانده شده</button>
    <button class="btn" data-filter="در حال خواندن">در حال خواندن</button>
    <button class="btn" data-filter="خوانده نشده">خوانده نشده</button>
  </div>
</div>
<div id="grid" class="grid"></div>

<script id="books-data" type="application/json">[{"title": "کتاب ته جدولی ها 1: (راز داورهای خواب آلود)", "author": "روبرتو سانتیاگو", "translator": "سعید متین", "publisher": "هوپا", "price": "1000", "status": "خوانده شده", "image_path": "Books Images/9786008869870.jpg", "isbn": "978-6008869870"}, {"title": "کتاب ته جدولی ها 2: (راز هفت گل به خودی)", "author": "روبرتو سانتیاگو", "translator": "سعید متین", "publisher": "هوپا", "price": "1000", "status": "خوانده شده", "image_path": "Books Images/9786222040024.jpg", "isbn": "978-6222040024"}, {"title": "کتاب ته جدولی ها 3: (راز دروازه بان شبح مانند)", "author": "روبرتو سانتیاگو", "translator": "سعید متین", "publisher": "هوپا", "price": "1000", "status": "خوانده شده", "image_path": "Books Images/9786222040550.jpg", "isbn": "978-6222040550"}, {"title": "کتاب ته جدولی ها 4: (راز چشم شاهین)", "author": "روبرتو سانتیاگو", "translator": "سعید متین", "publisher": "هوپا", "price": "1000", "status": "خوانده شده", "image_path": "Books Images/9786222040956.jpg", "isbn": "978-6222040956"}, {"title": "کتاب ته جدولی ها 5: راز سرقت غیر ممکن", "author": "روبرتو سانتیاگو", "translator": "سعید متین", "publisher": "هوپا", "price": "1000", "status": "خوانده شده", "image_path": "Books Images/9786222041458.jpg", "isbn": "978-6222041458"}, {"title": "کتاب ته جدولی ها 6: (راز قلعه ی افسون شده)", "author": "روبرتو سانتیاگو", "translator": "سعید متین", "publisher": "هوپا", "price": "1000", "status": "خوانده شده", "image_path": "Books Images/9786222041861.jpg", "isbn": "978-6222041861"}, {"title": "کتاب ته جدولی ها 7: (راز پنالتی نامرئی)", "author": "روبرتو سانتیاگو", "translator": "سعید متین", "publisher": "هوپا", "price": "1000", "status": "خوانده شده", "image_path": "Books Images/9786222042820.jpg", "isbn": "978-6222042820"}, {"title": "کتاب ته جدولی ها 8: (راز سیرک آتش)", "author": "روبرتو سانتیاگو", "translator": "سعید متین", "publisher": "هوپا", "price": "1000", "status": "خوانده شده", "image_path": "Books Images/9786222044015.jpg", "isbn": "978-6222044015"}, {"title": "کتاب ته جدولی‌ها 9: راز بارش شهابی", "author": "روبرتو سانتیاگو", "translator": "سعید متین", "publisher": "هوپا", "price": "1000", "status": "خوانده شده", "image_path": "Books Images/9786222044237.jpg", "isbn": "978-6222044237"}, {"title": "کتاب ته جدولی ها 10: راز گنج دزدان دریایی", "author": "روبرتو سانتیاگو", "translator": "سعید متین", "publisher": "هوپا", "price": "1000", "status": "در حال خواندن", "image_path": "Books Images/9786222046064.jpg", "isbn": "978-6222046064"}, {"title": "کتاب ته جدولی ها 11: معمای روز ساده لوحان", "author": "روبرتو سانتیاگو", "translator": "سعید متین", "publisher": "هوپا", "price": "1000", "status": "خوانده نشده", "image_path": "Books Images/9786222047016.jpg", "isbn": "978-6222047016"}]</script>

<script>
const books = JSON.parse(document.getElementById('books-data').textContent || '[]');
const grid = document.getElementById('grid');
const search = document.getElementById('search');
let activeFilter = 'all';
const defaultCover = 'default_cover.png';

// وضعیت را استاندارد می‌کند و کلاس مناسب را برمی‌گرداند
function statusClass(s){
  if(!s) return 'unread';
  const t = String(s).replace(/\s+/g,'').toLowerCase();
  if(t.includes('درحالخواندن') || t.includes('reading')) return 'reading';
  if(t.includes('خواندهنشده') || t.includes('نخوانده') || t.includes('unread')) return 'unread';
  if(t.includes('خواندهشده') || t.includes('خوانده') || t.includes('read')) return 'read';
  return 'unread';
}

// تابع renderBooks — می‌سازد کارت را با 6 بخش متا: نویسنده، مترجم، ناشر، امتیاز، وضعیت، شابک
function renderBooks(list){
  grid.innerHTML = '';
  const frag = document.createDocumentFragment();
  list.forEach(b=>{
    const card = document.createElement('div'); card.className = 'card fade-in';

    // تصویر جلد
    const img = document.createElement('img');
    img.className = 'cover';
    img.src = b.image_path || defaultCover;
    img.alt = 'جلد ' + (b.title || '');
    img.onerror = function(){ this.onerror=null; this.src = defaultCover; };

    // اطلاعات
    const info = document.createElement('div'); info.className = 'info';
    const h = document.createElement('div'); h.className='title';
    h.textContent = b.title || '(بدون عنوان)';

    // meta rows container
    const meta = document.createElement('div'); meta.className = 'meta-rows';

    // helper برای اضافه کردن سطر متا (label + value) — اگر مقدار خالی باشد نمایش نمی‌دهد
    function addMeta(labelText, valueText){
      const value = (valueText === null || valueText === undefined) ? '' : String(valueText).trim();
      if(!value) return;
      const row = document.createElement('div'); row.className='meta-row';
      const lbl = document.createElement('span'); lbl.className='meta-label'; lbl.textContent = labelText;
      const val = document.createElement('span'); val.className='meta-value'; val.textContent = value;
      row.appendChild(lbl); row.appendChild(val);
      meta.appendChild(row);
    }

    addMeta('نویسنده:', b.author);
    addMeta('مترجم:', b.translator);
    addMeta('ناشر:', b.publisher);


    // footer شامل badge وضعیت و قیمت (در صورت وجود)
    const footer = document.createElement('div'); footer.className='footer';
    const badge = document.createElement('span'); 
    const stClass = statusClass(b.status);
    badge.className = 'badge ' + (stClass === 'read' ? 'read' : stClass === 'reading' ? 'reading' : 'unread');
    badge.textContent = stClass === 'read' ? 'خوانده شده' : stClass === 'reading' ? 'در حال خواندن' : 'خوانده نشده';

    const price = document.createElement('div'); price.className='price';
    if(b.price) price.textContent = String(b.price) + ' امتیاز';

    footer.appendChild(badge);
    if(b.price) footer.appendChild(price);

    info.appendChild(h);
    info.appendChild(meta);
    info.appendChild(footer);

    card.appendChild(img);
    card.appendChild(info);
    frag.appendChild(card);
  });
  grid.appendChild(frag);
}

// فیلتر و جستجو
function applyFilters(){
  const q = (search.value || '').trim().toLowerCase();
  let filtered = books.filter(b=>{
    if(activeFilter !== 'all'){
      // بررسی برچسب وضعیت (به صورت رشته)
      if(!b.status || String(b.status).indexOf(activeFilter) === -1){
        // همچنین چک با کلاس وضعیت استاندارد
        const sc = statusClass(b.status);
        if(activeFilter === 'خوانده شده' && sc !== 'read') return false;
        if(activeFilter === 'در حال خواندن' && sc !== 'reading') return false;
        if(activeFilter === 'خوانده نشده' && sc !== 'unread') return false;
      }
    }
    if(q){
      const hay = ((b.title||'') + ' ' + (b.author||'') + ' ' + (b.publisher||'') + ' ' + (b.translator||'') + ' ' + (b.isbn||'')).toLowerCase();
      return hay.indexOf(q) !== -1;
    }
    return true;
  });
  renderBooks(filtered);
  updateCounters();
}

// به‌روزرسانی شمارنده‌ها
function updateCounters(){
  const counts = { all: books.length, read: 0, reading: 0, unread: 0 };
  books.forEach(b=>{
    const st = statusClass(b.status);
    counts[st] = (counts[st] || 0) + 1;
  });
  document.querySelectorAll('.btn').forEach(btn=>{
    const key = btn.getAttribute('data-filter');
    let text = btn.textContent.split(' (')[0];
    let count = 0;
    if(key === 'all') count = counts.all;
    else if(key === 'خوانده شده') count = counts.read;
    else if(key === 'در حال خواندن') count = counts.reading;
    else if(key === 'خوانده نشده') count = counts.unread;
    btn.textContent = text + ' (' + count + ')';
  });
}

// وصل کردن رویدادها
document.querySelectorAll('.btn').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    document.querySelectorAll('.btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    activeFilter = btn.getAttribute('data-filter') || 'all';
    applyFilters();
  });
});

search.addEventListener('input', ()=>{ applyFilters(); });

// شروع
renderBooks(books);
updateCounters();
</script>
</body>
</html>

